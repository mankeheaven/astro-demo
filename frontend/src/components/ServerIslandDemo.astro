---
// è¿™æ˜¯ä¸€ä¸ªæœåŠ¡å™¨ç¾¤å²›ç»„ä»¶
// å®ƒå°†åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼Œä½†å¯ä»¥åœ¨å®¢æˆ·ç«¯è¿›è¡Œæ°´åˆ

interface Props {
  title?: string;
  userId?: string;
}

const { title = "æœåŠ¡å™¨ç¾¤å²›ç¤ºä¾‹", userId } = Astro.props;

// æ¨¡æ‹ŸæœåŠ¡å™¨ç«¯æ•°æ®è·å–
async function fetchServerData() {
  // æ¨¡æ‹Ÿå¼‚æ­¥æ•°æ®è·å–
  await new Promise(resolve => setTimeout(resolve, 100));
  
  return {
    serverTime: new Date().toLocaleString('zh-CN'),
    randomNumber: Math.floor(Math.random() * 1000),
    serverInfo: {
      nodeVersion: process.version,
      platform: process.platform,
      uptime: Math.floor(process.uptime())
    }
  };
}

const serverData = await fetchServerData();

// æ¨¡æ‹Ÿç”¨æˆ·æ•°æ®è·å–
async function fetchUserData(userId: string) {
  if (!userId) return null;
  
  // æ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢
  await new Promise(resolve => setTimeout(resolve, 50));
  
  return {
    id: userId,
    name: `ç”¨æˆ·${userId}`,
    lastLogin: new Date(Date.now() - Math.random() * 86400000).toLocaleString('zh-CN'),
    preferences: {
      theme: Math.random() > 0.5 ? 'dark' : 'light',
      language: 'zh-CN'
    }
  };
}

const userData = userId ? await fetchUserData(userId) : null;
---

<div class="server-island bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-lg shadow-lg border border-blue-200">
  <h2 class="text-2xl font-bold text-blue-800 mb-4 flex items-center">
    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2"></path>
    </svg>
    {title}
  </h2>
  
  <div class="grid md:grid-cols-2 gap-6">
    <!-- æœåŠ¡å™¨ä¿¡æ¯ -->
    <div class="bg-white p-4 rounded-lg shadow">
      <h3 class="text-lg font-semibold text-gray-800 mb-3">ğŸ–¥ï¸ æœåŠ¡å™¨ä¿¡æ¯</h3>
      <div class="space-y-2 text-sm">
        <div class="flex justify-between">
          <span class="text-gray-600">æœåŠ¡å™¨æ—¶é—´:</span>
          <span class="font-mono text-blue-600">{serverData.serverTime}</span>
        </div>
        <div class="flex justify-between">
          <span class="text-gray-600">éšæœºæ•°:</span>
          <span class="font-mono text-green-600">{serverData.randomNumber}</span>
        </div>
        <div class="flex justify-between">
          <span class="text-gray-600">Node.js ç‰ˆæœ¬:</span>
          <span class="font-mono text-purple-600">{serverData.serverInfo.nodeVersion}</span>
        </div>
        <div class="flex justify-between">
          <span class="text-gray-600">å¹³å°:</span>
          <span class="font-mono text-orange-600">{serverData.serverInfo.platform}</span>
        </div>
        <div class="flex justify-between">
          <span class="text-gray-600">è¿è¡Œæ—¶é—´:</span>
          <span class="font-mono text-red-600">{serverData.serverInfo.uptime}ç§’</span>
        </div>
      </div>
    </div>

    <!-- ç”¨æˆ·ä¿¡æ¯ -->
    <div class="bg-white p-4 rounded-lg shadow">
      <h3 class="text-lg font-semibold text-gray-800 mb-3">ğŸ‘¤ ç”¨æˆ·ä¿¡æ¯</h3>
      {userData ? (
        <div class="space-y-2 text-sm">
          <div class="flex justify-between">
            <span class="text-gray-600">ç”¨æˆ·ID:</span>
            <span class="font-mono text-blue-600">{userData.id}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">ç”¨æˆ·å:</span>
            <span class="font-semibold text-green-600">{userData.name}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">æœ€åç™»å½•:</span>
            <span class="font-mono text-purple-600">{userData.lastLogin}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">ä¸»é¢˜:</span>
            <span class="font-semibold text-orange-600">{userData.preferences.theme}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">è¯­è¨€:</span>
            <span class="font-semibold text-red-600">{userData.preferences.language}</span>
          </div>
        </div>
      ) : (
        <div class="text-gray-500 text-center py-4">
          <p>æœªæä¾›ç”¨æˆ·ID</p>
          <p class="text-xs mt-1">è¯·åœ¨URLä¸­æ·»åŠ  ?userId=123 å‚æ•°</p>
        </div>
      )}
    </div>
  </div>

  <!-- æ¸²æŸ“ä¿¡æ¯ -->
  <div class="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
    <p class="text-sm text-yellow-800">
      <strong>ğŸï¸ æœåŠ¡å™¨ç¾¤å²›:</strong> æ­¤ç»„ä»¶åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼ŒåŒ…å«åŠ¨æ€æ•°æ®è·å–ã€‚
      æ¯æ¬¡é¡µé¢åŠ è½½æ—¶ï¼ŒæœåŠ¡å™¨æ—¶é—´å’Œéšæœºæ•°éƒ½ä¼šæ›´æ–°ã€‚
    </p>
  </div>
</div>

<style>
  .server-island {
    animation: fadeIn 0.5s ease-in-out;
  }
  
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style> 