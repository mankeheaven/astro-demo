---
import Layout from '../layouts/Layout.astro';
import UniversalStateReact from '../components/UniversalStateReact';
import UniversalStateVue from '../components/UniversalStateVue.vue';
---

<Layout title="è·¨æ¡†æ¶çŠ¶æ€å…±äº«">
	<div class="container mx-auto p-4">
		<h1 class="text-4xl font-bold mb-6 text-center dark:text-white">
			ğŸŒ è·¨æ¡†æ¶çŠ¶æ€å…±äº«æ¼”ç¤º
		</h1>
		
		<div class="mb-8 bg-gradient-to-r from-blue-100 to-purple-100 dark:from-blue-900 dark:to-purple-900 p-6 rounded-lg">
			<h2 class="text-2xl font-bold mb-4 dark:text-white">æ¼”ç¤ºè¯´æ˜</h2>
			<p class="text-gray-700 dark:text-gray-300 mb-4">
				è¿™ä¸ªé¡µé¢å±•ç¤ºäº†å¦‚ä½•åœ¨ä¸åŒçš„å‰ç«¯æ¡†æ¶ä¹‹é—´å…±äº«å…¨å±€çŠ¶æ€ã€‚ä¸‰ä¸ªç»„ä»¶ä½¿ç”¨åŒä¸€ä¸ªçŠ¶æ€ç®¡ç†å™¨ï¼š
			</p>
			<ul class="list-disc list-inside space-y-2 text-gray-700 dark:text-gray-300">
				<li><span class="font-semibold text-blue-600">ğŸ”µ Reactç»„ä»¶</span> - ä½¿ç”¨React Hookå’ŒuseState</li>
				<li><span class="font-semibold text-green-600">ğŸŸ¢ Vueç»„ä»¶</span> - ä½¿ç”¨Vue 3 Composition API</li>
				<li><span class="font-semibold text-yellow-600">ğŸŸ¡ Vanilla JSç»„ä»¶</span> - ä½¿ç”¨åŸç”ŸJavaScript</li>
			</ul>
			<p class="text-gray-700 dark:text-gray-300 mt-4">
				<strong>è¯•è¯•çœ‹ï¼š</strong> åœ¨ä»»ä½•ä¸€ä¸ªç»„ä»¶ä¸­ä¿®æ”¹è®¡æ•°å™¨ã€å‘é€æ¶ˆæ¯æˆ–åˆ‡æ¢ä¸»é¢˜ï¼Œå…¶ä»–ç»„ä»¶ä¼šç«‹å³åŒæ­¥æ›´æ–°ï¼
			</p>
		</div>
		
		<div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
			<!-- React ç»„ä»¶ -->
			<div>
				<UniversalStateReact client:load />
			</div>
			
			<!-- Vue ç»„ä»¶ -->
			<div>
				<UniversalStateVue client:load />
			</div>
			
			<!-- Vanilla JS ç»„ä»¶ -->
			<div>
				<div id="vanilla-container">
					<div class="p-6 rounded-lg shadow-lg border-2 border-yellow-200 bg-yellow-50 text-gray-800">
						<div class="text-center">
							<div class="animate-pulse">
								<div class="h-6 bg-gray-200 rounded w-3/4 mx-auto mb-4"></div>
								<div class="h-32 bg-gray-200 rounded mb-4"></div>
								<div class="h-4 bg-gray-200 rounded w-1/2 mx-auto"></div>
							</div>
							<p class="mt-4 text-sm text-gray-600">æ­£åœ¨åŠ è½½ Vanilla JS ç»„ä»¶...</p>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		<div class="mt-12 bg-gray-100 dark:bg-gray-800 p-6 rounded-lg">
			<h2 class="text-2xl font-bold mb-4 dark:text-white">æŠ€æœ¯å®ç°</h2>
			<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
				<div>
					<h3 class="text-lg font-semibold mb-2 dark:text-white">æ ¸å¿ƒç‰¹æ€§</h3>
					<ul class="list-disc list-inside space-y-1 text-gray-700 dark:text-gray-300">
						<li>æ¡†æ¶æ— å…³çš„çŠ¶æ€ç®¡ç†å™¨</li>
						<li>å‘å¸ƒ-è®¢é˜…æ¨¡å¼</li>
						<li>localStorageæŒä¹…åŒ–</li>
						<li>è·¨æ ‡ç­¾é¡µåŒæ­¥</li>
						<li>TypeScriptæ”¯æŒ</li>
					</ul>
				</div>
				<div>
					<h3 class="text-lg font-semibold mb-2 dark:text-white">é€‚ç”¨åœºæ™¯</h3>
					<ul class="list-disc list-inside space-y-1 text-gray-700 dark:text-gray-300">
						<li>å¾®å‰ç«¯æ¶æ„</li>
						<li>æ¸è¿›å¼è¿ç§»</li>
						<li>å¤šæ¡†æ¶å…±å­˜</li>
						<li>ç»„ä»¶åº“å¼€å‘</li>
						<li>è·¨é¡µé¢çŠ¶æ€å…±äº«</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
</Layout>

<style>
	:global(html.dark) {
		background-color: #1a202c;
		color: #e2e8f0;
	}
</style>

<script>
	// åŠ¨æ€å¯¼å…¥Vanilla JSç»„ä»¶ï¼Œé¿å…SSRé—®é¢˜
	async function initVanillaComponent() {
		try {
			const { createUniversalStateVanilla } = await import('../components/UniversalStateVanilla.js');
			
			const container = document.getElementById('vanilla-container');
			if (container) {
				// æ¸…é™¤åŠ è½½æç¤º
				container.innerHTML = '';
				
				// åˆ›å»ºç»„ä»¶
				const vanillaComponent = createUniversalStateVanilla('vanilla-container');
				
				// åœ¨é¡µé¢å¸è½½æ—¶æ¸…ç†
				window.addEventListener('beforeunload', () => {
					if (vanillaComponent) {
						vanillaComponent.destroy();
					}
				});
				
				console.log('âœ… Vanilla JS ç»„ä»¶åˆå§‹åŒ–æˆåŠŸ');
			} else {
				console.error('âŒ æ‰¾ä¸åˆ° vanilla-container å…ƒç´ ');
			}
		} catch (error) {
			console.error('âŒ Vanilla JS ç»„ä»¶åˆå§‹åŒ–å¤±è´¥:', error);
			
			// æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
			const container = document.getElementById('vanilla-container');
			if (container) {
				const errorMessage = error instanceof Error ? error.message : String(error);
				container.innerHTML = `
					<div class="p-6 rounded-lg shadow-lg border-2 border-red-200 bg-red-50 text-red-800">
						<h3 class="font-bold mb-2">ğŸŸ¡ Vanilla JS ç»„ä»¶</h3>
						<p class="text-sm">ç»„ä»¶åŠ è½½å¤±è´¥: ${errorMessage}</p>
						<button onclick="location.reload()" class="mt-2 px-3 py-1 bg-red-500 text-white rounded text-sm">
							é‡æ–°åŠ è½½
						</button>
					</div>
				`;
			}
		}
	}
	
	// ç¡®ä¿åœ¨DOMåŠ è½½å®Œæˆååˆå§‹åŒ–
	if (document.readyState === 'loading') {
		document.addEventListener('DOMContentLoaded', initVanillaComponent);
	} else {
		// DOMå·²ç»åŠ è½½å®Œæˆ
		initVanillaComponent();
	}
	
	// åˆå§‹åŒ–ä¸»é¢˜
	document.addEventListener('DOMContentLoaded', () => {
		const theme = localStorage.getItem('theme') || 'light';
		document.documentElement.classList.add(theme);
	});
</script> 